# The Locus Class

The `locus` is the fundamental data type in `gstudio`. It is an S3 class that stores a genotype as a colon-separated string of alleles. This chapter covers creating, manipulating, and converting locus objects.

```{r}
library(gstudio)
```

## Creating Locus Objects

The `locus()` constructor takes a vector of alleles and collapses them into a single genotype:

```{r}
loc <- locus(c("A", "B"))
loc
```

Homozygotes and higher-ploidy genotypes work the same way:

```{r}
locus(c("A", "A"))
locus(c("A", "B", "C", "D"))
```

### Missing Data

Missing data is represented as an empty string internally:

```{r}
loc_missing <- locus()
loc_missing
is.na(loc_missing)
```

## Marker Types

The `type` parameter controls how raw data is interpreted:

### Codominant (default)

Alleles are sorted alphabetically and joined with `:`:

```{r}
locus(c("B", "A"), type = "codom")
```

### AFLP

Binary presence/absence data (0 or 1):

```{r}
locus("1", type = "aflp")
locus("0", type = "aflp")
```

### SNP

Encoded as 0, 1, or 2 (count of minor alleles):

```{r}
locus("0", type = "snp")
locus("1", type = "snp")
locus("2", type = "snp")
```

### Separated

Pre-formatted colon-separated strings:

```{r}
locus("A:B", type = "separated")
```

### Zyme (allozyme)

Alleles encoded as concatenated integers (e.g., "12" = alleles 1 and 2):

```{r}
locus("12", type = "zyme")
locus("23", type = "zyme")
```

### Column

Two-column matrix format (used internally by `read_population()`):

```{r}
alleles_mat <- cbind(c("A", "B", "C"), c("B", "A", "C"))
locus(alleles_mat, type = "column")
```

## Working with Vectors of Loci

Genotype vectors are created using `c()`:

```{r}
AA <- locus(c("A", "A"))
AB <- locus(c("A", "B"))
BB <- locus(c("B", "B"))
loci <- c(AA, AB, AB, AA, BB)
loci
```

### Indexing

```{r}
loci[2]
loci[c(1, 3, 5)]
```

### Replication

```{r}
rep(AB, times = 3)
```

## Extracting Alleles

The `alleles()` function returns the component alleles:

```{r}
alleles(AB)
alleles(loci)
```

## Heterozygosity Testing

```{r}
is_heterozygote(AA)
is_heterozygote(AB)
is_heterozygote(loci)
```

## Operator Overloads

### Mating (`+`)

The `+` operator simulates mating by randomly sampling one allele from each parent:

```{r}
dad <- locus(c("A", "A"))
mom <- locus(c("B", "B"))
set.seed(42)
offspring <- mom + dad
offspring
```

### Parental Subtraction (`-`)

The `-` operator removes the maternal contribution from an offspring genotype:

```{r}
off <- locus(c("A", "B"))
mom <- locus(c("A", "A"))
paternal_gamete <- off - mom
paternal_gamete
```

This is useful in parentage analysis for identifying the paternal allelic contribution.

## Coercion

### To Data Frame

```{r}
as.data.frame(loci)
```

### From Other Types

```{r}
as.locus(c("A", "B"))
as.locus(list("C", "D"))
```

### Is-a Test

```{r}
is.locus(AB)
is.locus("not a locus")
```

## Multivariate Conversion

The `to_mv()` function converts locus data to a multivariate numeric format suitable for ordination and graph analysis:

```{r}
data(arapat)
mv <- to_mv(arapat)
dim(mv)
mv[1:5, 1:6]
```

Each allele at each locus becomes a column, with values representing allele counts (0, 1, or 2 for diploids). This is the input format for `popgraph()`.
