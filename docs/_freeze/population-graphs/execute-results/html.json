{
  "hash": "45b79ad36bfdbdcb1b2e14a38c523da5",
  "result": {
    "engine": "knitr",
    "markdown": "# Population Graphs\n\nPopulation Graphs are a graph-theoretic approach to understanding among-population genetic connectivity (Dyer & Nason 2004). Rather than assuming a specific model of gene flow (e.g., island or stepping-stone), population graphs estimate the conditional genetic covariance structure among populations, retaining only statistically significant edges.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(gstudio)\nlibrary(igraph)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAttaching package: 'igraph'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following objects are masked from 'package:stats':\n\n    decompose, spectrum\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following object is masked from 'package:base':\n\n    union\n```\n\n\n:::\n\n```{.r .cell-code}\ndata(arapat)\n```\n:::\n\n\n## Constructing a Population Graph\n\n### From a Data Frame\n\nThe easiest way to create a population graph is with `population_graph()`, which handles the conversion from genotypes to multivariate data internally:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngraph <- population_graph(arapat, stratum = \"Species\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in popgraph(data, groups, ...): 1 variables are collinear and being\ndropped from the discriminant rotation.\n```\n\n\n:::\n\n```{.r .cell-code}\ngraph\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nIGRAPH 45b720f UNW- 3 3 -- \n+ attr: name (v/c), size (v/n), weight (e/n)\n+ edges from 45b720f (vertex names):\n[1] Cape    --Mainland  Cape    --Peninsula Mainland--Peninsula\n```\n\n\n:::\n:::\n\n\n### From a Multivariate Matrix\n\nFor more control, convert genotypes to multivariate format first, then call `popgraph()` directly:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmv <- to_mv(arapat)\ngroups <- factor(arapat$Species)\ngraph <- popgraph(mv, groups)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in popgraph(mv, groups): 1 variables are collinear and being dropped\nfrom the discriminant rotation.\n```\n\n\n:::\n\n```{.r .cell-code}\ngraph\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nIGRAPH b02f179 UNW- 3 3 -- \n+ attr: name (v/c), size (v/n), weight (e/n)\n+ edges from b02f179 (vertex names):\n[1] Cape    --Mainland  Cape    --Peninsula Mainland--Peninsula\n```\n\n\n:::\n:::\n\n\nThe `alpha` parameter controls edge retention significance (default 0.05):\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngraph_strict <- popgraph(mv, groups, alpha = 0.01)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in popgraph(mv, groups, alpha = 0.01): 1 variables are collinear and\nbeing dropped from the discriminant rotation.\n```\n\n\n:::\n\n```{.r .cell-code}\ngraph_strict\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nIGRAPH 35c848d UNW- 3 3 -- \n+ attr: name (v/c), size (v/n), weight (e/n)\n+ edges from 35c848d (vertex names):\n[1] Cape    --Mainland  Cape    --Peninsula Mainland--Peninsula\n```\n\n\n:::\n:::\n\n\n### From an Adjacency Matrix\n\nUse `as.popgraph()` to convert a pre-computed adjacency matrix:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nA <- matrix(c(0, 1, 0, 1,\n              1, 0, 1, 0,\n              0, 1, 0, 1,\n              1, 0, 1, 0), nrow = 4)\nrownames(A) <- colnames(A) <- LETTERS[1:4]\ng <- as.popgraph(A)\ng\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nIGRAPH ec84e43 UNW- 4 4 -- \n+ attr: name (v/c), weight (e/n)\n+ edges from ec84e43 (vertex names):\n[1] A--B A--D B--C C--D\n```\n\n\n:::\n:::\n\n\n## Bundled Population Graphs\n\nThe package includes two pre-computed population graphs:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata(lopho)\nlopho\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThis graph was created by an old(er) igraph version.\nℹ Call `igraph::upgrade_graph()` on it to use with the current igraph version.\nFor now we convert it on the fly...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\nIGRAPH 6af7beb UNW- 21 52 -- \n+ attr: name (v/c), size (v/n), color (v/c), Region (v/c), weight (e/n)\n+ edges from 6af7beb (vertex names):\n [1] BaC--LaV    BaC--Lig    BaC--PtC    BaC--PtP    BaC--SnE    BaC--SnI   \n [7] BaC--StR    Ctv--PtP    Ctv--SLG    Ctv--SnF    Ctv--SenBas LaV--Lig   \n[13] LaV--PtC    LaV--SnE    LaV--SnF    LaV--TsS    Lig--PtC    Lig--SnI   \n[19] Lig--StR    Lig--TsS    PtC--SnE    PtC--StR    PtC--TsS    PtC--SenBas\n[25] PtP--SnF    PtP--SnI    PtP--SenBas SLG--SnF    SLG--SnI    SnE--StR   \n[31] SnE--TsS    SnF--SnI    SnI--StR    StR--TsS    StR--SenBas CP --Seri  \n[37] CP --SG     CP --SN     CP --TS     LF --PL     LF --SG     LF --SI    \n[43] PL --SenBas PL --SG     PL --SI     PL --SN    \n+ ... omitted several edges\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata(upiga)\nupiga\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThis graph was created by an old(er) igraph version.\nℹ Call `igraph::upgrade_graph()` on it to use with the current igraph version.\nFor now we convert it on the fly...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\nIGRAPH 3157d53 UNW- 18 58 -- \n+ attr: name (v/c), size (v/n), color (v/c), weight (e/n)\n+ edges from 3157d53 (vertex names):\n [1] SI  --PL     SI  --LF     SI  --CP     SI  --Ctv    SI  --TrV   \n [6] SI  --SenBas SG  --CP     SG  --Seri   SG  --EH     SG  --LaV   \n[11] PL  --LF     PL  --SN     PL  --Seri   PL  --EH     PL  --SenBas\n[16] TS  --CP     TS  --SN     TS  --Seri   TS  --EH     TS  --Ctv   \n[21] TS  --LaV    TS  --SnF    LF  --CP     LF  --SN     LF  --Ctv   \n[26] LF  --SLG    LF  --SnF    LF  --SnE    CP  --SN     CP  --EH    \n[31] CP  --LaV    CP  --SenBas SN  --Seri   SN  --SenBas Seri--SLG   \n[36] EH  --SLG    EH  --SenBas Ctv --SLG    Ctv --TrV    Ctv --BaC   \n+ ... omitted several edges\n```\n\n\n:::\n:::\n\n\n## Decorating a Graph\n\nThe `decorate_graph()` function merges external data into graph vertex attributes. This is essential for spatial visualization:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata(baja)\nhead(baja)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  Region Population Latitude Longitude\n1   Baja        BaC    26.59   -111.79\n2   Baja        Ctv    29.73   -114.72\n3   Baja        LaV    24.04   -109.99\n4   Baja        Lig    25.73   -111.27\n5   Baja        PtC    24.19   -111.15\n6   Baja        PtP    29.03   -113.90\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlopho_dec <- decorate_graph(lopho, baja, stratum = \"Population\")\nvertex_attr_names(lopho_dec)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"name\"      \"size\"      \"color\"     \"Region\"    \"Latitude\"  \"Longitude\"\n```\n\n\n:::\n:::\n\n\nNow the graph nodes carry coordinate and metadata attributes.\n\n## Graph Metrics\n\n### Node Properties\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Vertex names\nV(lopho)$name\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"BaC\"    \"Ctv\"    \"LaV\"    \"Lig\"    \"PtC\"    \"PtP\"    \"SLG\"    \"SnE\"   \n [9] \"SnF\"    \"SnI\"    \"StR\"    \"TsS\"    \"CP\"     \"LF\"     \"PL\"     \"SenBas\"\n[17] \"Seri\"   \"SG\"     \"SI\"     \"SN\"     \"TS\"    \n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Degree (number of edges)\ndegree(lopho)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   BaC    Ctv    LaV    Lig    PtC    PtP    SLG    SnE    SnF    SnI    StR \n     7      4      6      6      7      5      3      5      5      6      7 \n   TsS     CP     LF     PL SenBas   Seri     SG     SI     SN     TS \n     5      4      3      5      5      3      5      5      5      3 \n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Betweenness centrality\nbetweenness(lopho)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   BaC    Ctv    LaV    Lig    PtC    PtP    SLG    SnE    SnF    SnI    StR \n     9     31      4      0      0     25      3      0     16      8     30 \n   TsS     CP     LF     PL SenBas   Seri     SG     SI     SN     TS \n     0      2      0     92     98      1     32     15      0      0 \n```\n\n\n:::\n:::\n\n\n### Centroid Distance\n\nThe multivariate centroid distance between population centroids in discriminant space:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmv <- to_mv(arapat)\ngroups <- factor(arapat$Species)\ncd <- centroid_distance(mv, groups)\ncd\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n               [,1]      [,2]      [,3]      [,4]       [,5]       [,6]\nCape      0.0800000 0.9200000 0.1333333 0.8533333 0.00000000 0.00000000\nMainland  0.2638889 0.7361111 0.8194444 0.0000000 0.01388889 0.00000000\nPeninsula 0.6924603 0.3075397 0.3432540 0.0000000 0.59920635 0.03769841\n                 [,7]      [,8]       [,9]      [,10]       [,11]       [,12]\nCape      0.000000000 0.3000000 0.70000000 0.00000000 0.000000000 0.000000000\nMainland  0.000000000 0.2222222 0.00000000 0.63888889 0.111111111 0.000000000\nPeninsula 0.003968254 0.9007937 0.04960317 0.02380952 0.009920635 0.007936508\n              [,13]      [,14]      [,15]     [,16]       [,17]       [,18]\nCape      0.9666667 0.03333333 0.00000000 0.9333333 0.000000000 0.000000000\nMainland  0.7916667 0.15277778 0.02777778 0.5277778 0.000000000 0.000000000\nPeninsula 0.5714286 0.42857143 0.27976190 0.6726190 0.001984127 0.001984127\n               [,19]     [,20]       [,21]      [,22]     [,23]      [,24]\nCape      0.08666667 0.5733333 0.286666667 0.00000000 0.0000000 0.00000000\nMainland  0.00000000 0.0000000 0.000000000 0.00000000 0.0000000 0.05555556\nPeninsula 0.00000000 0.0000000 0.009920635 0.09722222 0.3174603 0.33730159\n              [,25]      [,26]       [,27]     [,28]       [,29]      [,30]\nCape      0.0000000 0.00000000 0.000000000 0.0000000 0.000000000 0.01333333\nMainland  0.0000000 0.01388889 0.361111111 0.1527778 0.000000000 0.00000000\nPeninsula 0.1964286 0.01785714 0.001984127 0.0000000 0.001984127 0.00000000\n                [,31]      [,32]      [,33] [,34] [,35]      [,36]      [,37]\nCape      0.013333333 0.94000000 0.00000000 0.000  0.02 0.00000000 0.00000000\nMainland  0.861111111 0.01388889 0.05555556 0.000  0.00 0.00000000 0.00000000\nPeninsula 0.003968254 0.00000000 0.00000000 0.625  0.00 0.03968254 0.03571429\n               [,38]       [,39]      [,40]      [,41]      [,42]      [,43]\nCape      0.01333333 0.000000000 0.00000000 0.00000000 0.00000000 0.00000000\nMainland  0.06944444 0.000000000 0.01388889 0.08333333 0.08333333 0.00000000\nPeninsula 0.28968254 0.005952381 0.00000000 0.00000000 0.00000000 0.01190476\n               [,44]     [,45]     [,46]      [,47]      [,48]      [,49]\nCape      0.00000000 0.0000000 0.0000000 0.00000000 0.00000000 0.00000000\nMainland  0.01388889 0.0000000 0.0000000 0.00000000 0.02777778 0.04166667\nPeninsula 0.38293651 0.1150794 0.3730159 0.03571429 0.00000000 0.01785714\n               [,50]     [,51]     [,52]      [,53]       [,54]       [,55]\nCape      0.00000000 0.0000000 0.0000000 0.00000000 0.000000000 0.006666667\nMainland  0.09722222 0.2916667 0.2222222 0.04166667 0.000000000 0.000000000\nPeninsula 0.05357143 0.0000000 0.0000000 0.00000000 0.001984127 0.000000000\n          [,56]     [,57] [,58]\nCape       0.18 0.7733333  0.04\nMainland   0.00 0.0000000  0.00\nPeninsula  0.00 0.0000000  0.00\n```\n\n\n:::\n:::\n\n\n### Centroid Variance\n\nMultivariate variance around each population centroid:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncv <- centroid_variance(mv, groups)\ncv\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     Cape  Mainland Peninsula \n 1.519820  2.169841  2.886842 \n```\n\n\n:::\n:::\n\n\n### Shannon Entropy\n\nShannon entropy quantifies the uncertainty in a probability distribution:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Entropy of the degree distribution\ndeg <- degree(lopho)\np <- deg / sum(deg)\nshannon_entropy(p)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 4.344766\n```\n\n\n:::\n:::\n\n\n### Edge Contortion\n\nA measure of how edges deviate from geographic expectations (requires decorated graph with coordinates):\n\n\n::: {.cell}\n\n```{.r .cell-code}\nedge_contortion(lopho_dec)\n```\n:::\n\n\n## Congruence Testing\n\n### Topology Congruence\n\nCompare the topology of two population graphs:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata(lopho)\ndata(upiga)\ncongruence_topology(lopho, upiga)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThis graph was created by an old(er) igraph version.\nℹ Call `igraph::upgrade_graph()` on it to use with the current igraph version.\nFor now we convert it on the fly...\nThis graph was created by an old(er) igraph version.\nℹ Call `igraph::upgrade_graph()` on it to use with the current igraph version.\nFor now we convert it on the fly...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in congruence_topology(lopho, upiga): These two topologies have\nnon-overlapping node sets!  Careful on interpretation.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\nIGRAPH 93b08a9 UN-- 16 19 -- \n+ attr: name (v/c)\n+ edges from 93b08a9 (vertex names):\n [1] BaC --LaV    BaC --SnE    BaC --StR    Ctv --SLG    Ctv --SnF   \n [6] LaV --SnE    SLG --SnF    StR --SenBas CP  --SG     CP  --SN    \n[11] CP  --TS     LF  --PL     LF  --SI     PL  --SenBas PL  --SI    \n[16] PL  --SN     Seri--SG     Seri--SN     SN  --TS    \n```\n\n\n:::\n:::\n\n\n### Statistical Testing\n\nUse `test_congruence()` to test whether two graphs are more similar in topology than expected by chance:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntest_congruence(lopho, upiga, method = \"combinatorial\")\n```\n:::\n\n\n### Permutation\n\nThe `permute_popgraph()` function creates a null distribution of graph topologies by permuting the data:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnull_graphs <- permute_popgraph(mv, groups, nperm = 99)\n```\n:::\n\n\n## Subgraph Operations\n\nThe `-` operator computes the difference between two popgraphs (removes edges in common). You can also extract subgraphs using igraph functions:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsmaller <- delete_vertices(lopho, \"SenBas\")\nV(smaller)$name\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"BaC\"  \"Ctv\"  \"LaV\"  \"Lig\"  \"PtC\"  \"PtP\"  \"SLG\"  \"SnE\"  \"SnF\"  \"SnI\" \n[11] \"StR\"  \"TsS\"  \"CP\"   \"LF\"   \"PL\"   \"Seri\" \"SG\"   \"SI\"   \"SN\"   \"TS\"  \n```\n\n\n:::\n:::\n\n\n## Export Formats\n\n### To Adjacency Matrix\n\n\n::: {.cell}\n\n```{.r .cell-code}\nM <- to_matrix(lopho)\nM[1:5, 1:5]\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n    BaC Ctv LaV Lig PtC\nBaC   0   0   1   1   1\nCtv   0   0   0   0   0\nLaV   1   0   0   1   1\nLig   1   0   1   0   1\nPtC   1   0   1   1   0\n```\n\n\n:::\n:::\n\n\n### To Data Frame\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf <- to_df(lopho)\nhead(df)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  name      size   color Region\n1  BaC 12.158810 #FDAE61   Baja\n2  Ctv  3.880886 #FDAE61   Baja\n3  LaV  3.533757 #FDAE61   Baja\n4  Lig  4.731355 #FDAE61   Baja\n5  PtC  4.684652 #FDAE61   Baja\n6  PtP 10.925375 #FDAE61   Baja\n```\n\n\n:::\n:::\n\n\n### To JSON\n\n\n::: {.cell}\n\n```{.r .cell-code}\njson <- to_json(lopho)\ncat(json)\n```\n:::\n\n\n### To Spatial Formats\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# As sf object\nsf_obj <- to_sf(lopho_dec)\n\n# As KML\nto_kml(lopho_dec, file = \"lopho.kml\")\n```\n:::\n\n\n### To pgraph Format\n\nThe `.pgraph` format is a simple text representation:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite_popgraph(lopho_dec, file = \"lopho.pgraph\")\n```\n:::\n\n\n### Reading a Population Graph\n\n\n::: {.cell}\n\n```{.r .cell-code}\npath <- system.file(\"extdata\", \"lopho.pgraph\", package = \"gstudio\")\ng <- read_popgraph(path)\ng\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nIGRAPH 10edd5e UNW- 21 50 -- \n+ attr: name (v/c), size (v/n), color (v/c), weight (e/n)\n+ edges from 10edd5e (vertex names):\n [1] BaC --LaV    BaC --Lig    BaC --PtP    BaC --SnE    BaC --SnI   \n [6] BaC --StR    BaC --SenBas Ctv --PtP    Ctv --SLG    Ctv --SnF   \n[11] Ctv --SenBas LaV --Lig    LaV --SnE    LaV --SnF    LaV --TsS   \n[16] Lig --PtC    Lig --SnE    Lig --SnI    Lig --StR    PtC --SnE   \n[21] PtC --StR    PtC --TsS    PtP --SnF    PtP --SnI    PtP --SenBas\n[26] SLG --SnF    SLG --SnI    SnE --StR    SnE --TsS    SnF --SnI   \n[31] SnI --StR    StR --TsS    StR --SenBas CP  --LF     CP  --Seri  \n[36] CP  --SG     CP  --SN     CP  --TS     LF  --PL     LF  --SG    \n+ ... omitted several edges\n```\n\n\n:::\n:::\n\n\n## Randomization\n\nGenerate a random graph with the same number of nodes and a specified number of edges:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrg <- randomize_graph(lopho)\nrg\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nIGRAPH ac565aa UN-- 21 52 -- \n+ attr: name (v/c)\n+ edges from ac565aa (vertex names):\n [1] BaC   --SnF    BaC   --SnE    BaC   --SenBas BaC   --SLG    BaC   --PL    \n [6] BaC   --SI     BaC   --TsS    CP    --TS     CP    --SnI    TsS   --CP    \n[11] CP    --PtC    SnF   --Ctv    SenBas--Ctv    PtC   --Ctv    TS    --Ctv   \n[16] TS    --LaV    TsS   --LaV    LaV   --Lig    SenBas--LaV    LaV   --SN    \n[21] SnE   --LF     LF    --SG     SnI   --LF     Lig   --StR    TsS   --Lig   \n[26] Lig   --PtP    Lig   --SN     PL    --PtC    SnF   --PL     PL    --SI    \n[31] PL    --SN     PtC   --Lig    PtC   --SN     PtC   --SG     PtC   --PtP   \n[36] StR   --PtP    PtP   --Seri   SnI   --PtP    SenBas--Seri   SnE   --Seri  \n+ ... omitted several edges\n```\n\n\n:::\n:::\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}