{
  "hash": "ea369bb4deb2dda76f21d8775dbf9069",
  "result": {
    "engine": "knitr",
    "markdown": "# Genetic Distance & Relatedness\n\nThis chapter covers inter-individual and inter-population distance estimation, pairwise relatedness, and spatial autocorrelation analysis.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(gstudio)\ndata(arapat)\n```\n:::\n\n\n## Genetic Distance\n\nThe `genetic_distance()` function computes distance matrices from genetic data. Some modes operate among individuals, others among populations (strata).\n\n### Available Distance Metrics\n\n| Mode | Level | Description |\n|------|-------|-------------|\n| `\"AMOVA\"` | Individual | Inter-individual AMOVA distance |\n| `\"Bray\"` | Individual | Proportion of shared alleles |\n| `\"Euclidean\"` | Population | Euclidean frequency distance |\n| `\"cGD\"` | Population | Conditional genetic distance |\n| `\"Nei\"` | Population | Nei's genetic distance (1978) |\n| `\"Dps\"` | Population | Shared allele distance (1 - Ps) |\n| `\"Jaccard\"` | Population | Jaccard set dissimilarity |\n\n### Individual-Level Distances\n\nAMOVA distance computes inter-individual genetic distances:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Subset for a manageable example\nsub <- arapat[1:20, ]\nD_amova <- genetic_distance(sub, mode = \"AMOVA\")\ndim(D_amova)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 20 20\n```\n\n\n:::\n\n```{.r .cell-code}\nD_amova[1:5, 1:5]\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     [,1] [,2] [,3] [,4] [,5]\n[1,]    0   NA   NA   NA   NA\n[2,]   NA    0    1    2    5\n[3,]   NA    1    0    3    2\n[4,]   NA    2    3    0    5\n[5,]   NA    5    2    5    0\n```\n\n\n:::\n:::\n\n\n### Population-Level Distances\n\nPopulation-level distances require a stratum column:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nD_nei <- genetic_distance(arapat, stratum = \"Species\", mode = \"Nei\")\nD_nei\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n               Cape  Mainland Peninsula\nCape      0.0000000 0.7311289 0.9244791\nMainland  0.7311289 0.0000000 0.6851578\nPeninsula 0.9244791 0.6851578 0.0000000\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nD_cgd <- genetic_distance(arapat, stratum = \"Species\", mode = \"cGD\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in popgraph::popgraph(x = mv, groups =\nfactor(as.character(x[[stratum]]))): 1 variables are collinear and being\ndropped from the discriminant rotation.\n```\n\n\n:::\n\n```{.r .cell-code}\nD_cgd\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n              Cape  Mainland Peninsula\nCape      0.000000  9.913083  7.136108\nMainland  9.913083  0.000000 16.490315\nPeninsula 7.136108 16.490315  0.000000\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nD_euc <- genetic_distance(arapat, stratum = \"Species\",\n                           mode = \"Euclidean\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nMultilous estimates of Euclidean distance are assumed to be additive.\n```\n\n\n:::\n\n```{.r .cell-code}\nD_euc\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n              Cape Mainland Peninsula\nCape      0.000000 2.418731  2.494205\nMainland  2.418731 0.000000  2.140258\nPeninsula 2.494205 2.140258  0.000000\n```\n\n\n:::\n:::\n\n\n### Standalone Distance Functions\n\nEach distance metric also has a standalone function:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nD <- dist_nei(arapat, stratum = \"Species\")\nD\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n               Cape  Mainland Peninsula\nCape      0.0000000 0.7311289 0.9244791\nMainland  0.7311289 0.0000000 0.6851578\nPeninsula 0.9244791 0.6851578 0.0000000\n```\n\n\n:::\n:::\n\n\n## Genetic Relatedness\n\nThe `genetic_relatedness()` function computes pairwise relatedness among individuals.\n\n### Available Relatedness Estimators\n\n| Mode | Description |\n|------|-------------|\n| `\"Nason\"` | Nason's kinship coefficient (Fij) |\n| `\"LynchRitland\"` | Lynch & Ritland estimator |\n| `\"Ritland\"` | Ritland estimator |\n\n### Basic Usage\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsub <- arapat[1:10, ]\nR <- genetic_relatedness(sub, mode = \"Nason\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nSome of your loci are missing, Fij will treat these as loci with all alleles with likelihood equal to the population allele frequency.\nSome of your loci are missing, Fij will treat these as loci with all alleles with likelihood equal to the population allele frequency.\nSome of your loci are missing, Fij will treat these as loci with all alleles with likelihood equal to the population allele frequency.\n```\n\n\n:::\n\n```{.r .cell-code}\ndim(R)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 10 10\n```\n\n\n:::\n\n```{.r .cell-code}\nR[1:5, 1:5]\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     [,1] [,2] [,3] [,4] [,5]\n[1,]    1  NaN  NaN  NaN  NaN\n[2,]  NaN    1  NaN  NaN  NaN\n[3,]  NaN  NaN    1  NaN  NaN\n[4,]  NaN  NaN  NaN    1  NaN\n[5,]  NaN  NaN  NaN  NaN    1\n```\n\n\n:::\n:::\n\n\n### Standalone Relatedness Functions\n\nPer-locus relatedness can also be estimated directly:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nr_nason <- rel_nason(arapat$LTRS[1:10])\nr_nason[1:5, 1:5]\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     [,1] [,2] [,3] [,4] [,5]\n[1,]   NA  NaN  NaN  NaN  NaN\n[2,]  NaN   NA  NaN  NaN  NaN\n[3,]  NaN  NaN   NA  NaN  NaN\n[4,]  NaN  NaN  NaN   NA  NaN\n[5,]  NaN  NaN  NaN  NaN   NA\n```\n\n\n:::\n:::\n\n\n## Spatial Autocorrelation\n\nThe `genetic_autocorrelation()` function performs the spatial autocorrelation analysis of Smouse & Peakall (1999). It requires two square distance matrices --- one physical, one genetic --- and a vector of distance bin boundaries:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Physical distance matrix\nP <- strata_distance(arapat,\n                     longitude = \"Longitude\",\n                     latitude = \"Latitude\")\n\n# Genetic distance matrix\nG <- genetic_distance(arapat, mode = \"AMOVA\")\n\n# Define distance bins\nbins <- seq(0, max(P), length.out = 6)\n\n# Run autocorrelation\nresult <- genetic_autocorrelation(P, G, bins = bins, perms = 99)\nresult\n```\n:::\n\n\nThe output includes the spatial autocorrelation coefficient (R) for each distance class, the number of pairwise comparisons (N), and a p-value from the permutation test (P).\n\n## Strata Distances\n\nThe `strata_coordinates()` function extracts per-stratum centroid coordinates, and `strata_distance()` computes physical (geographic) distances between them:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncoords <- strata_coordinates(arapat, stratum = \"Species\",\n                              longitude = \"Longitude\",\n                              latitude = \"Latitude\")\ncoords\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n    Stratum Longitude Latitude\n3 Peninsula -111.9226 26.18956\n1      Cape -110.5805 24.25405\n2  Mainland -109.6759 26.97435\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstrata_distance(coords)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n          Peninsula     Cape Mainland\nPeninsula    0.0000 254.0525 239.8471\nCape       254.0525   0.0000 315.7868\nMainland   239.8471 315.7868   0.0000\n```\n\n\n:::\n:::\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}