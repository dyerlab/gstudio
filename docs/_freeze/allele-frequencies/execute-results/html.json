{
  "hash": "b3e9ab91525080b7069bfdf178b4c194",
  "result": {
    "engine": "knitr",
    "markdown": "# Allele Frequencies & HWE\n\nThis chapter covers estimating allele and genotype frequencies, testing for Hardy-Weinberg Equilibrium, and rarefaction analysis.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(gstudio)\ndata(arapat)\n```\n:::\n\n\n## Allele Frequencies\n\nThe `frequencies()` function is an S3 generic that works on both individual locus vectors and entire data.frames.\n\n### Single Locus\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfrequencies(arapat$LTRS)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  Allele Frequency\n1     01  0.523416\n2     02  0.476584\n```\n\n\n:::\n:::\n\n\n### Entire Data Frame\n\nWhen applied to a data.frame, `frequencies()` returns frequencies for all locus columns:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfreqs <- frequencies(arapat)\nhead(freqs, 12)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   Locus Allele   Frequency\n1   LTRS     01 0.523415978\n2   LTRS     02 0.476584022\n3    WNT     01 0.357954545\n4    WNT     02 0.181818182\n5    WNT     03 0.430397727\n6    WNT     04 0.026988636\n7    WNT     05 0.002840909\n8     EN     01 0.715277778\n9     EN     02 0.180555556\n10    EN     03 0.080555556\n11    EN     04 0.018055556\n12    EN     05 0.005555556\n```\n\n\n:::\n:::\n\n\n### By Stratum\n\nAdd a `stratum` argument to partition frequencies by population:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfreqs_pop <- frequencies(arapat, stratum = \"Species\")\nhead(freqs_pop, 12)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   Stratum Locus Allele  Frequency\n1     Cape  LTRS     01 0.08000000\n2     Cape  LTRS     02 0.92000000\n3     Cape   WNT     01 0.13513514\n4     Cape   WNT     02 0.86486486\n5     Cape    EN     01 0.30000000\n6     Cape    EN     02 0.70000000\n7     Cape    EF     01 0.96666667\n8     Cape    EF     02 0.03333333\n9     Cape   ZMP     02 1.00000000\n10    Cape   AML     03 0.09154930\n11    Cape   AML     04 0.60563380\n12    Cape   AML     05 0.30281690\n```\n\n\n:::\n:::\n\n\n### Selecting Specific Loci\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfreqs_sub <- frequencies(arapat, loci = c(\"LTRS\", \"WNT\"))\nfreqs_sub\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  Locus Allele   Frequency\n1  LTRS     01 0.523415978\n2  LTRS     02 0.476584022\n3   WNT     01 0.357954545\n4   WNT     02 0.181818182\n5   WNT     03 0.430397727\n6   WNT     04 0.026988636\n7   WNT     05 0.002840909\n```\n\n\n:::\n:::\n\n\n## Frequency Matrix\n\nThe `frequency_matrix()` function produces a wide-format matrix of allele frequencies:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfm <- frequency_matrix(arapat, stratum = \"Species\")\nfm[, 1:8]\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n    Stratum      AML-01      AML-02    AML-03    AML-04     AML-05     AML-06\n1      Cape 0.000000000 0.000000000 0.0915493 0.6056338 0.30281690 0.00000000\n2  Mainland 0.000000000 0.000000000 0.0000000 0.0000000 0.00000000 0.00000000\n3 Peninsula 0.002016129 0.002016129 0.0000000 0.0000000 0.01008065 0.09879032\n     AML-07\n1 0.0000000\n2 0.0000000\n3 0.3225806\n```\n\n\n:::\n:::\n\n\n## Genotype Counts and Frequencies\n\n### Genotype Counts per Stratum\n\nThe `genotype_counts()` function summarizes non-missing genotype counts per locus, optionally by stratum:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngenotype_counts(arapat)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n    Stratum   N LTRS WNT  EN  EF ZMP AML ATPS MP20\nALL     ALL 363  363 352 360 361 330 340  363  358\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngenotype_counts(arapat, stratum = \"Species\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n            Stratum   N LTRS WNT  EN  EF ZMP AML ATPS MP20\nCape           Cape  75   75  74  75  75  70  71   75   75\nMainland   Mainland  36   36  30  35  34  20  21   36   33\nPeninsula Peninsula 252  252 248 250 252 240 248  252  250\n```\n\n\n:::\n:::\n\n\n### Genotype Frequencies\n\nThe `genotype_frequencies()` function returns observed and expected genotype counts for a locus vector:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngenotype_frequencies(arapat$LTRS)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  Genotype Observed  Expected\n1    01:01      147  99.44904\n2    01:02       86 181.10193\n3    02:02      130  82.44904\n```\n\n\n:::\n:::\n\n\n## Hardy-Weinberg Equilibrium\n\nThe `hwe()` function tests for HWE using a chi-square approximation:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmainland <- arapat[arapat$Species == \"Mainland\", ]\nhwe(mainland)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in genotype_frequencies(x[[locus]]): Some genotype expectations are <\n5, a continuity correction should be applied.  See ?hwe\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in hwe(mainland): Under 50 samples for LTRS this may not be a good\napproximation.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in hwe(mainland): Fewer than 5 genotypes expected at LTRS consider\ncollapsing alleles.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in genotype_frequencies(x[[locus]]): Some genotype expectations are <\n5, a continuity correction should be applied.  See ?hwe\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in hwe(mainland): Under 50 samples for WNT this may not be a good\napproximation.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in hwe(mainland): Fewer than 5 genotypes expected at WNT consider\ncollapsing alleles.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in genotype_frequencies(x[[locus]]): Some genotype expectations are <\n5, a continuity correction should be applied.  See ?hwe\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in hwe(mainland): Under 50 samples for EN this may not be a good\napproximation.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in hwe(mainland): Fewer than 5 genotypes expected at EN consider\ncollapsing alleles.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in genotype_frequencies(x[[locus]]): Some genotype expectations are <\n5, a continuity correction should be applied.  See ?hwe\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in hwe(mainland): Under 50 samples for EF this may not be a good\napproximation.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in hwe(mainland): Fewer than 5 genotypes expected at EF consider\ncollapsing alleles.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in genotype_frequencies(x[[locus]]): Some genotype expectations are <\n5, a continuity correction should be applied.  See ?hwe\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in hwe(mainland): Under 50 samples for ZMP this may not be a good\napproximation.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in hwe(mainland): Fewer than 5 genotypes expected at ZMP consider\ncollapsing alleles.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in genotype_frequencies(x[[locus]]): Some genotype expectations are <\n5, a continuity correction should be applied.  See ?hwe\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in hwe(mainland): Under 50 samples for AML this may not be a good\napproximation.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in hwe(mainland): Fewer than 5 genotypes expected at AML consider\ncollapsing alleles.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in genotype_frequencies(x[[locus]]): Some genotype expectations are <\n5, a continuity correction should be applied.  See ?hwe\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in hwe(mainland): Under 50 samples for ATPS this may not be a good\napproximation.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in hwe(mainland): Fewer than 5 genotypes expected at ATPS consider\ncollapsing alleles.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in genotype_frequencies(x[[locus]]): Some genotype expectations are <\n5, a continuity correction should be applied.  See ?hwe\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in hwe(mainland): Under 50 samples for MP20 this may not be a good\napproximation.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in hwe(mainland): Fewer than 5 genotypes expected at MP20 consider\ncollapsing alleles.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  Locus         Chi df         Prob\n1  LTRS   0.9082806  1 3.405710e-01\n2   WNT  29.2542373  1 6.347726e-08\n3    EN  19.7817078  3 1.883729e-04\n4    EF   0.3545808  1 5.515314e-01\n5   ZMP   5.0927978  1 2.402540e-02\n6   AML  36.8802692  6 1.858093e-06\n7  ATPS  43.9698647  6 7.494505e-08\n8  MP20 161.5565210 45 4.773959e-15\n```\n\n\n:::\n:::\n\n\nThe output includes the chi-square statistic, degrees of freedom, and p-value for each locus. Significant p-values indicate departures from HWE expectations.\n\n### Interpreting Results\n\nDepartures from HWE can arise from:\n\n- Non-random mating (inbreeding, assortative mating)\n- Population substructure (Wahlund effect)\n- Selection at or near the marker locus\n- Small population size (genetic drift)\n\n## Rarefaction\n\nThe `rarefaction()` function subsamples the data repeatedly at a smaller sample size to estimate the distribution of a diversity statistic:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrare_vals <- rarefaction(arapat$LTRS, mode = \"Ae\",\n                         size = 20, nperm = 199)\nhist(rare_vals, main = \"Rarefied Ae at LTRS\",\n     xlab = \"Effective Alleles\", col = \"steelblue\")\n```\n\n::: {.cell-output-display}\n![](allele-frequencies_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\nThis is useful for comparing diversity across populations with unequal sample sizes.\n\n## Optimal Sampling\n\nThe `optimal_sampling()` function estimates how many individuals are needed to capture a given proportion of allelic diversity:\n\n\n::: {.cell}\n\n```{.r .cell-code}\noptimal_sampling(arapat$LTRS, nrep = 99)\n```\n:::\n\n",
    "supporting": [
      "allele-frequencies_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}