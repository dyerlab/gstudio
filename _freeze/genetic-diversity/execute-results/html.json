{
  "hash": "08372dec884e1b10bec309569b45b87a",
  "result": {
    "engine": "knitr",
    "markdown": "# Genetic Diversity\n\nThis chapter covers estimation of genetic diversity statistics using the `genetic_diversity()` wrapper and its underlying per-locus functions.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(gstudio)\ndata(arapat)\n```\n:::\n\n\n## The `genetic_diversity()` Wrapper\n\nThe `genetic_diversity()` function is the main entry point for diversity estimation. It dispatches to specific estimators based on the `mode` parameter:\n\n| Mode | Statistic | Description |\n|------|-----------|-------------|\n| `\"A\"` | Allelic richness | Number of alleles |\n| `\"Ae\"` | Effective alleles | $1 / \\sum p_i^2$ |\n| `\"A95\"` | A (5% threshold) | Alleles with frequency >= 0.05 |\n| `\"He\"` | Expected heterozygosity | $1 - \\sum p_i^2$ |\n| `\"Ho\"` | Observed heterozygosity | Proportion of heterozygotes |\n| `\"Hes\"` | Corrected He | Nei's small-sample corrected He |\n| `\"Hos\"` | Corrected Ho | Nei's small-sample corrected Ho |\n| `\"Fis\"` | Inbreeding coefficient | $1 - H_o/H_e$ |\n| `\"Pe\"` | Polymorphic index | Whether the locus is polymorphic |\n\n## Global (Unstratified) Estimates\n\nWithout a stratum, diversity is estimated across all individuals:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngenetic_diversity(arapat, mode = \"A\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  Locus  A\n1  LTRS  2\n2   WNT  5\n3    EN  5\n4    EF  2\n5   ZMP  2\n6   AML 13\n7  ATPS 10\n8  MP20 19\n```\n\n\n:::\n\n```{.r .cell-code}\ngenetic_diversity(arapat, mode = \"Ae\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  Locus       Ae\n1  LTRS 1.995623\n2   WNT 2.880450\n3    EN 1.814656\n4    EF 1.773533\n5   ZMP 1.513877\n6   AML 5.860583\n7  ATPS 3.563347\n8  MP20 5.511837\n```\n\n\n:::\n\n```{.r .cell-code}\ngenetic_diversity(arapat, mode = \"He\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  Locus        He\n1  LTRS 0.4989034\n2   WNT 0.6528320\n3    EN 0.4489313\n4    EF 0.4361538\n5   ZMP 0.3394444\n6   AML 0.8293685\n7  ATPS 0.7193649\n8  MP20 0.8185723\n```\n\n\n:::\n\n```{.r .cell-code}\ngenetic_diversity(arapat, mode = \"Ho\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  Locus         Ho\n1  LTRS 0.23691460\n2   WNT 0.27840909\n3    EN 0.20555556\n4    EF 0.14404432\n5   ZMP 0.15454545\n6   AML 0.37058824\n7  ATPS 0.08539945\n8  MP20 0.44692737\n```\n\n\n:::\n:::\n\n\n## Per-Stratum Estimates\n\nProvide a `stratum` argument to compute diversity within each population:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngenetic_diversity(arapat, stratum = \"Species\", mode = \"He\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     Stratum Locus         He\n2       Cape  LTRS 0.14720000\n3       Cape   WNT 0.23374726\n4       Cape    EN 0.42000000\n5       Cape    EF 0.06444444\n6       Cape   ZMP 0.00000000\n7       Cape   AML 0.53312835\n8       Cape  ATPS 0.11546667\n9       Cape  MP20 0.36791111\n10  Mainland  LTRS 0.38850309\n11  Mainland   WNT 0.03277778\n12  Mainland    EN 0.50285714\n13  Mainland    EF 0.27119377\n14  Mainland   ZMP 0.09500000\n15  Mainland   AML 0.53854875\n16  Mainland  ATPS 0.25038580\n17  Mainland  MP20 0.80670340\n18 Peninsula  LTRS 0.42591805\n19 Peninsula   WNT 0.50613781\n20 Peninsula    EN 0.17229600\n21 Peninsula    EF 0.48979592\n22 Peninsula   ZMP 0.41492187\n23 Peninsula   AML 0.72842417\n24 Peninsula  ATPS 0.52255763\n25 Peninsula  MP20 0.69148800\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngenetic_diversity(arapat, stratum = \"Species\", mode = \"Ae\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     Stratum Locus       Ae\n2       Cape  LTRS 1.172608\n3       Cape   WNT 1.305052\n4       Cape    EN 1.724138\n5       Cape    EF 1.068884\n6       Cape   ZMP 1.000000\n7       Cape   AML 2.141916\n8       Cape  ATPS 1.130540\n9       Cape  MP20 1.582056\n10  Mainland  LTRS 1.635331\n11  Mainland   WNT 1.033889\n12  Mainland    EN 2.011494\n13  Mainland    EF 1.372107\n14  Mainland   ZMP 1.104972\n15  Mainland   AML 2.167076\n16  Mainland  ATPS 1.334020\n17  Mainland  MP20 5.173397\n18 Peninsula  LTRS 1.741912\n19 Peninsula   WNT 2.024856\n20 Peninsula    EN 1.208161\n21 Peninsula    EF 1.960000\n22 Peninsula   ZMP 1.709173\n23 Peninsula   AML 3.682213\n24 Peninsula  ATPS 2.094494\n25 Peninsula  MP20 3.241365\n```\n\n\n:::\n:::\n\n\n## Individual Estimator Functions\n\nEach diversity metric has a standalone function that operates on a single locus vector.\n\n### Allelic Richness\n\n\n::: {.cell}\n\n```{.r .cell-code}\nA(arapat$LTRS)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nA \n2 \n```\n\n\n:::\n:::\n\n\n### Effective Number of Alleles\n\n\n::: {.cell}\n\n```{.r .cell-code}\nAe(arapat$LTRS)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n      Ae \n1.995623 \n```\n\n\n:::\n:::\n\n\n### Expected Heterozygosity\n\n\n::: {.cell}\n\n```{.r .cell-code}\nHe(arapat$LTRS)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n       He \n0.4989034 \n```\n\n\n:::\n:::\n\n\n### Observed Heterozygosity\n\n\n::: {.cell}\n\n```{.r .cell-code}\nHo(arapat$LTRS)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n       Ho \n0.2369146 \n```\n\n\n:::\n:::\n\n\n### Inbreeding Coefficient\n\n\n::: {.cell}\n\n```{.r .cell-code}\nFis(arapat$LTRS)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n      Fis \n0.5251293 \n```\n\n\n:::\n:::\n\n\n### Exclusion Probability\n\n\n::: {.cell}\n\n```{.r .cell-code}\nPe(arapat$LTRS)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.4989034\n```\n\n\n:::\n:::\n\n\n## Corrected Heterozygosity (Nei's)\n\nThe `Hes` and `Hos` modes require a stratum because they apply a small-sample correction per subpopulation:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngenetic_diversity(arapat, stratum = \"Species\", mode = \"Hes\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n       Locus       Hes\n1       LTRS 0.3233431\n2        WNT 0.2606681\n3         EN 0.3687470\n4         EF 0.2781409\n5        ZMP 0.1731159\n6        AML 0.6108282\n7       ATPS 0.2999070\n8       MP20 0.6284672\n9 Multilocus 0.3679022\n```\n\n\n:::\n:::\n\n\n## Multilocus Diversity\n\nThe `multilocus_diversity()` function computes a summary across all loci:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmultilocus_diversity(arapat)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.8374656\n```\n\n\n:::\n:::\n\n\n## Selecting Specific Loci\n\nYou can restrict the analysis to a subset of loci:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngenetic_diversity(arapat, loci = c(\"LTRS\", \"WNT\"), mode = \"He\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  Locus        He\n1  LTRS 0.4989034\n2   WNT 0.6528320\n```\n\n\n:::\n:::\n\n\n## Comparing Populations\n\nA common workflow is to estimate diversity per population, then compare:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhe_by_pop <- genetic_diversity(arapat, stratum = \"Species\", mode = \"He\")\nhe_by_pop\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     Stratum Locus         He\n2       Cape  LTRS 0.14720000\n3       Cape   WNT 0.23374726\n4       Cape    EN 0.42000000\n5       Cape    EF 0.06444444\n6       Cape   ZMP 0.00000000\n7       Cape   AML 0.53312835\n8       Cape  ATPS 0.11546667\n9       Cape  MP20 0.36791111\n10  Mainland  LTRS 0.38850309\n11  Mainland   WNT 0.03277778\n12  Mainland    EN 0.50285714\n13  Mainland    EF 0.27119377\n14  Mainland   ZMP 0.09500000\n15  Mainland   AML 0.53854875\n16  Mainland  ATPS 0.25038580\n17  Mainland  MP20 0.80670340\n18 Peninsula  LTRS 0.42591805\n19 Peninsula   WNT 0.50613781\n20 Peninsula    EN 0.17229600\n21 Peninsula    EF 0.48979592\n22 Peninsula   ZMP 0.41492187\n23 Peninsula   AML 0.72842417\n24 Peninsula  ATPS 0.52255763\n25 Peninsula  MP20 0.69148800\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\nggplot(he_by_pop, aes(x = Stratum, y = He, fill = Stratum)) +\n  geom_boxplot() +\n  theme_minimal() +\n  labs(title = \"Expected Heterozygosity by Species\",\n       y = \"He\") +\n  theme(legend.position = \"none\")\n```\n\n::: {.cell-output-display}\n![](genetic-diversity_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n\n",
    "supporting": [
      "genetic-diversity_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}