{
  "hash": "ed745e00be2d509d8bc0b5bb6bb77d23",
  "result": {
    "engine": "knitr",
    "markdown": "# Visualization\n\nThe `gstudio` package provides several `ggplot2` layers and mapping tools for visualizing genetic data. This chapter covers allele frequency plots, population maps, population graph visualization, and interactive leaflet maps.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(gstudio)\nlibrary(ggplot2)\ndata(arapat)\n```\n:::\n\n\n## Allele Frequency Plots\n\n### `geom_locus()`\n\nThe `geom_locus()` function creates a bar chart of allele frequencies for a single locus. Map the locus to the `x` aesthetic:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  geom_locus(aes(x = LTRS), data = arapat) +\n  labs(title = \"Allele Frequencies at LTRS\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](visualization_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\nPartition by population using the `fill` aesthetic:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  geom_locus(aes(x = LTRS, fill = Species), data = arapat) +\n  labs(title = \"LTRS Allele Frequencies by Species\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](visualization_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n### `geom_frequencies()`\n\nThe `geom_frequencies()` function takes pre-computed frequency data (from `frequencies()`) and plots it. This gives you more control over faceting:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfreqs <- frequencies(arapat, loci = \"LTRS\", stratum = \"Species\")\nggplot() +\n  geom_frequencies(freqs) +\n  facet_wrap(~Stratum) +\n  labs(title = \"LTRS Frequencies by Species\") +\n  theme_minimal() +\n  theme(legend.position = \"none\")\n```\n\n::: {.cell-output-display}\n![](visualization_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n## Spatial Sampling Maps\n\n### `geom_strata()`\n\nThe `geom_strata()` function plots sampling locations as points on a map. It expects `Longitude` and `Latitude` columns in the data:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  geom_strata(aes(x = Longitude, y = Latitude, fill = Species),\n              data = arapat) +\n  labs(title = \"Araptus attenuatus Sampling Locations\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](visualization_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n### `geom_strata_label()`\n\nAdd text labels to strata locations:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  geom_strata(aes(x = Longitude, y = Latitude), data = arapat) +\n  geom_strata_label(aes(x = Longitude, y = Latitude,\n                         label = Species),\n                    data = arapat) +\n  theme_minimal()\n```\n:::\n\n\n## Population Graph Visualization\n\n### `geom_popgraph()`\n\nThe `geom_popgraph()` function creates a complete population graph visualization (edges + nodes) in a single call:\n\n\n::: {.cell}\n\n```{.r .cell-code}\na <- matrix(c(0, 1, 0, 1,\n              1, 0, 1, 0,\n              0, 1, 0, 1,\n              1, 0, 1, 0), nrow = 4)\nrownames(a) <- colnames(a) <- LETTERS[1:4]\ngraph <- as.popgraph(a)\nigraph::V(graph)$x <- c(1, 2, 1, 2)\nigraph::V(graph)$y <- c(1, 1, 2, 2)\nigraph::V(graph)$group <- c(\"X\", \"X\", \"Y\", \"Y\")\n```\n:::\n\n\nBasic graph:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  geom_popgraph(graph, aes(x = x, y = y)) +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](visualization_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\nColor nodes by group:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  geom_popgraph(graph, aes(x = x, y = y, fill = group)) +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](visualization_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n#### Customizing Appearance\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  geom_popgraph(graph, aes(x = x, y = y, fill = group),\n                node.size = 5,\n                edge.color = \"darkgrey\",\n                edge.width = 1) +\n  theme_void()\n```\n\n::: {.cell-output-display}\n![](visualization_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\n#### Auto Layout\n\nIf `x` and `y` are not specified, a force-directed layout is computed automatically:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  geom_popgraph(graph) +\n  theme_void()\n```\n\n::: {.cell-output-display}\n![](visualization_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\n### `geom_nodeset()` and `geom_edgeset()`\n\nFor finer control, use the separate node and edge layers:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  geom_edgeset(graph, aes(x = x, y = y)) +\n  geom_nodeset(graph, aes(x = x, y = y, fill = group)) +\n  theme_void()\n```\n:::\n\n\n### Edge Labels\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  geom_popgraph(graph, aes(x = x, y = y)) +\n  geom_edgelabels(graph, aes(x = x, y = y)) +\n  theme_void()\n```\n:::\n\n\n## Spatial Population Graphs\n\nA common workflow is to decorate a population graph with coordinates and then overlay it on a map:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata(lopho)\ndata(baja)\nlopho_dec <- decorate_graph(lopho, baja, stratum = \"Population\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThis graph was created by an old(er) igraph version.\nâ„¹ Call `igraph::upgrade_graph()` on it to use with the current igraph version.\nFor now we convert it on the fly...\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  geom_popgraph(lopho_dec,\n                aes(x = Longitude, y = Latitude),\n                node.size = 4) +\n  labs(title = \"Lophocereus Population Graph\",\n       x = \"Longitude\", y = \"Latitude\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](visualization_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n\n\n## Spider Plots\n\nThe `spiderplot_data()` function creates line segment data connecting each individual to its population centroid, useful for visualizing spatial dispersion:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nspider <- spiderplot_data(arapat,\n                          stratum = \"Species\",\n                          longitude = \"Longitude\",\n                          latitude = \"Latitude\")\nggplot() +\n  geom_segment(aes(x = Longitude, y = Latitude,\n                   xend = cLongitude, yend = cLatitude,\n                   color = Species),\n               data = spider, alpha = 0.3) +\n  geom_point(aes(x = Longitude, y = Latitude, color = Species),\n             data = arapat) +\n  theme_minimal()\n```\n:::\n\n\n## Interactive Leaflet Maps\n\nThe `addAlleleFrequencies()` function creates interactive leaflet maps with pie charts showing allele frequencies at each sampling location. This requires the `leaflet` and `leaflet.minicharts` packages:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(leaflet)\nlibrary(leaflet.minicharts)\n\naddAlleleFrequencies(arapat,\n                     stratum = \"Species\",\n                     locus = \"LTRS\",\n                     longitude = \"Longitude\",\n                     latitude = \"Latitude\")\n```\n:::\n\n",
    "supporting": [
      "visualization_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}